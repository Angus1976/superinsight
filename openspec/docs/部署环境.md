# SuperInsight 部署文档（1.3 版）

**文档完成日期**：2025年12月10日

## 1. 部署模式总览

| 部署模式       | 适用场景                               | 数据位置       | 推荐云厂商/环境               | 复杂度 | 推荐指数 |
|----------------|----------------------------------------|----------------|-------------------------------|--------|----------|
| SaaS 多租户    | 创业公司/服务商对外提供服务           | 云端统一存储   | 腾讯云 TCB / 云托管 / TCR     | ★☆☆☆☆ | ★★★★★   |
| 完全私有化     | 企业内部自用，数据敏感度高             | 客户本地/私有云| 本地服务器、阿里云/华为云私有云 | ★★☆☆☆ | ★★★★☆   |
| 混合部署（推荐）| 客户数据必须留在内网，但希望使用云端应用 | 数据留在客户侧 | 腾讯云 + 客户内网（Frp/ZeroTier）| ★★★☆☆ | ★★★★★   |

## 2. 系统最低硬件要求（生产环境推荐）

| 组件           | 测试环境（单机）     | 生产环境（推荐）               |
|----------------|----------------------|--------------------------------|
| CPU            | 4核                  | 8核以上（建议16核）            |
| 内存           | 8GB                  | 32GB+（建议64GB）              |
| 磁盘           | 100GB SSD            | 500GB+ SSD（建议1TB+）         |
| 网络           | 100Mbps              | 1Gbps+                         |
| 数据库         | MySQL/MongoDB 单机   | MySQL 主从 + MongoDB 分片      |
| Redis          | 单机                 | Redis Cluster 或哨兵模式       |

## 3. 软件依赖（所有模式通用）

- Docker 24+ & Docker Compose 2+
- Python 3.11（镜像内已包含）
- Node.js 20+（前端构建时使用）
- 腾讯云账号（SaaS/混合部署需要）：TCB、TCR、云托管

## 4. 部署方式详解

### 4.1 私有化部署（单机/集群）

```bash
# 1. 克隆项目（建议使用 Git 仓库或已打包的 zip）
git clone https://github.com/your-org/superinsight.git
cd superinsight

# 2. 复制并编辑环境变量
cp .env.example .env
# 必填项示例：
# MYSQL_ROOT_PASSWORD=xxxx
# REDIS_PASSWORD=xxxx
# MONGODB_URI=mongodb://mongo:27017/superinsight
# SECRET_KEY=your_random_secret_key

# 3. 启动（首次会自动拉取镜像）
docker-compose up -d

# 4. 查看日志（首次启动会自动初始化）
docker-compose logs -f superset

# 5. 访问
http://您的服务器IP:8088
默认账号：admin / admin
4.2 SaaS 多租户版（腾讯云一键部署）

构建并推送自定义镜像到腾讯云 TCR
# 在本地构建
docker build -t superinsight:1.3 -f backend/docker/Dockerfile .
docker tag superinsight:1.3 ccr.ccs.tencentyun.com/your-namespace/superinsight:1.3
docker push ccr.ccs.tencentyun.com/your-namespace/superinsight:1.3
2在腾讯云云托管创建服务


镜像：选择 TCR 中的 superinsight:1.3
环境变量：
TENANT_MODE=multi
SUPERSET_ENV=production
MYSQL_ROOT_PASSWORD=...
REDIS_PASSWORD=...

端口：8088
自动扩缩容：建议开启


域名绑定（推荐）


使用腾讯云 DNSPod 配置子域名（如 tenant1.superinsight.cn）

4.3 混合部署（数据留在客户内网）
步骤 1：客户侧部署轻量 Connector 或 Frp/ZeroTier
（推荐 Frp 开源内网穿透）
# frpc.ini（客户侧示例）
[common]
server_addr = frp.server.com
server_port = 7000
token = your_token

[mysql]
type = tcp
local_ip = 127.0.0.1
local_port = 3306
remote_port = 3306
步骤 2：云端 Superset 配置连接
在 Superset 数据源中填写客户内网地址（通过穿透后的端口）
步骤 3：开启连接监控
访问 /admin → “连接状态”面板，可实时查看每个租户的数据源健康状态
5. 常见问题与解决方案

问题,可能原因,解决方法
首次启动报错“数据库不存在”,容器启动顺序问题,等待 30-60s 后重启 docker-compose up -d
连接超时,Frp/ZeroTier 断开,检查客户侧 frpc 是否运行，查看监控面板
标注卡顿,大宽表未开启瓦片化,确认 performance-optimization 模块已部署
内存不足,MongoDB 单机模式,增加内存或启用分片（sharding.py）
登录失败,SECRET_KEY 未设置,检查 .env 中的 SECRET_KEY 是否一致
问题可能原因解决方法首次启动报错“数据库不存在”容器启动顺序问题等待 30-60s 后重启 docker-compose up -d连接超时Frp/ZeroTier 断开检查客户侧 frpc 是否运行，查看监控面板标注卡顿大宽表未开启瓦片化确认 performance-optimization 模块已部署内存不足MongoDB 单机模式增加内存或启用分片（sharding.py）登录失败SECRET_KEY 未设置检查 .env 中的 SECRET_KEY 是否一致
6. 运维建议

定期备份：MySQL、MongoDB、Redis（建议每周全量 + 每日增量）
日志管理：使用 ELK 或腾讯云 CLS 收集容器日志
监控告警：接入 Prometheus + Grafana，或腾讯云监控
更新升级：新版本发布后仅需重新构建镜像并重启服务

7. 联系支持
如需部署协助、定制化部署脚本、私有化运维服务，或遇到任何问题，请联系：
邮箱：xxx@email.com
微信/企业微信：（可补充）
祝您部署顺利！SuperInsight 已就绪，随时为您释放数据价值。